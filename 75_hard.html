<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>75 Hard Challenge Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #2E7D32;
            --background-color: #f0f2f5;
            --card-background: #ffffff;
            --text-color: #333333;
            --border-radius: 12px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        /* Custom styles for the circular progress bar */
        .progress-circle {
            position: relative;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: conic-gradient(var(--primary-color) 0%, var(--primary-color) 0%, #e0e0e0 0%);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.5s ease-in-out;
        }

        .progress-circle::before {
            content: '';
            position: absolute;
            width: 130px;
            height: 130px;
            background-color: var(--card-background);
            border-radius: 50%;
        }

        .progress-circle span {
            position: relative;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        @keyframes fill {
            from {
                background: conic-gradient(var(--primary-color) 0%, var(--primary-color) 0%, #e0e0e0 0%);
            }
        }

        /* Modal styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border-radius: 12px;
            max-width: 400px;
            text-align: center;
        }
    </style>
</head>
<body class="p-4 md:p-8 bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <div class="container mx-auto grid gap-6 md:gap-8">
        <header class="text-center">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-gray-100 rounded-xl bg-white dark:bg-gray-800 p-4 shadow-lg">Twój 75 Hard Tracker</h1>
            <p class="mt-2 text-lg text-gray-600 dark:text-gray-400">Śledź swój postęp dzień po dniu!</p>
        </header>

        <div class="col-span-1">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg transition-colors duration-300">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700 dark:text-gray-200">Postęp Wyzwania</h2>
                
                <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0 md:space-x-4 mb-6">
                    <div class="flex items-center space-x-4">
                        <label for="startDate" class="text-lg">Data rozpoczęcia:</label>
                        <input type="date" id="startDate" class="p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-700">
                    </div>
                    <span id="endDate" class="text-lg font-semibold text-gray-600 dark:text-gray-400"></span>
                </div>

                <div class="flex flex-col items-center justify-center mb-6">
                    <div class="progress-circle">
                        <span id="progressText">0%</span>
                    </div>
                    <p class="text-center mt-4 text-xl font-bold text-gray-700 dark:text-gray-200"><span id="currentDay">0</span> / 75 dni</p>
                </div>

                <div class="grid grid-cols-5 sm:grid-cols-10 md:grid-cols-15 gap-2 mt-6" id="dayTracker">
                    <!-- Day boxes will be generated by JavaScript -->
                </div>
            </div>
            
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-lg mt-6 transition-colors duration-300">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700 dark:text-gray-200">Tracker nawyków tygodniowych</h2>
                <div class="flex items-center justify-between mb-4">
                    <button id="prevWeekBtn" class="px-3 py-2 bg-gray-300 text-gray-800 rounded-full shadow-md hover:bg-gray-400 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <span id="weekTitle" class="text-lg font-semibold">Tydzień 1</span>
                    <button id="nextWeekBtn" class="px-3 py-2 bg-gray-300 text-gray-800 rounded-full shadow-md hover:bg-gray-400 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
                <div class="flex items-center space-x-3 mb-4">
                    <input type="text" id="newHabitInput" placeholder="Dodaj nowy nawyk (np. bieganie)" class="flex-grow p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-700">
                    <button id="addHabitBtn" class="px-6 py-2 bg-green-500 text-white font-semibold rounded-full shadow-md hover:bg-green-600 transition-colors duration-300">Dodaj nawyk</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                        <thead>
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nawyk</th>
                                <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Akcje</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">1</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">2</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">3</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">4</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">5</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">6</th>
                                <th class="px-2 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">7</th>
                            </tr>
                        </thead>
                        <tbody id="habitTrackerTableBody" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                            <!-- Habit rows will be generated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- The Modal for delete confirmation -->
    <div id="deleteModal" class="modal">
        <div class="modal-content bg-white dark:bg-gray-800 shadow-xl rounded-xl">
            <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-gray-100">Potwierdź usunięcie</h3>
            <p class="text-gray-700 dark:text-gray-300 mb-6">Czy na pewno chcesz usunąć ten nawyk?</p>
            <div class="flex justify-center space-x-4">
                <button id="cancelDeleteBtn" class="px-6 py-2 bg-gray-300 text-gray-800 rounded-full hover:bg-gray-400 transition-colors duration-300">Anuluj</button>
                <button id="confirmDeleteBtn" class="px-6 py-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors duration-300">Usuń</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const startDateInput = document.getElementById('startDate');
            const endDateDisplay = document.getElementById('endDate');
            const currentDayDisplay = document.getElementById('currentDay');
            const progressText = document.getElementById('progressText');
            const dayTracker = document.getElementById('dayTracker');
            const progressCircle = document.querySelector('.progress-circle');
            
            const newHabitInput = document.getElementById('newHabitInput');
            const addHabitBtn = document.getElementById('addHabitBtn');
            const habitTrackerTableBody = document.getElementById('habitTrackerTableBody');
            
            const prevWeekBtn = document.getElementById('prevWeekBtn');
            const nextWeekBtn = document.getElementById('nextWeekBtn');
            const weekTitle = document.getElementById('weekTitle');

            const deleteModal = document.getElementById('deleteModal');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            let habitToDelete = null;

            const totalDays = 75;
            const totalWeeks = Math.ceil(totalDays / 7);
            let currentWeek = 1;

            // Load all data from local storage on page load
            loadData();

            function loadData() {
                const savedStartDate = localStorage.getItem('startDate');
                if (savedStartDate) {
                    startDateInput.value = savedStartDate;
                    updateDates(savedStartDate);
                    updateTracker(); // Update tracker without date dependency
                }
                renderHabitTracker();
            }

            function updateDates(startDateStr) {
                const startDate = new Date(startDateStr);
                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + totalDays - 1);
                endDateDisplay.textContent = `Zakończenie: ${endDate.toLocaleDateString('pl-PL')}`;
            }

            function updateTracker() {
                dayTracker.innerHTML = '';
                
                const completedDays = JSON.parse(localStorage.getItem('completedDays')) || {};
                let completedCount = 0;
                
                for (let i = 1; i <= totalDays; i++) {
                    const dayBox = document.createElement('div');
                    dayBox.className = 'day-box w-8 h-8 md:w-10 md:h-10 rounded-full flex items-center justify-center font-bold text-sm md:text-base transition-colors duration-300';
                    dayBox.dataset.day = i;
                    dayBox.classList.add('bg-gray-300', 'text-gray-600');
                    dayBox.style.pointerEvents = 'none';

                    if (completedDays[i]) {
                        completedCount++;
                        dayBox.classList.add('bg-green-500', 'text-white');
                        dayBox.classList.remove('bg-gray-300', 'text-gray-600');
                    }
                    
                    dayTracker.appendChild(dayBox);
                }
                
                localStorage.setItem('completedDays', JSON.stringify(completedDays));
                currentDayDisplay.textContent = completedCount;
                updateProgressCircle(completedCount);
            }
            
            function updateProgressCircle(completedCount) {
                const progress = Math.min(100, Math.round((completedCount / totalDays) * 100));
                progressText.textContent = `${progress}%`;
                progressCircle.style.background = `conic-gradient(var(--primary-color) ${progress}%, #e0e0e0 ${progress}%)`;
            }

            // Habit Tracker
            addHabitBtn.addEventListener('click', () => {
                const newHabit = newHabitInput.value.trim();
                if (newHabit) {
                    const habits = JSON.parse(localStorage.getItem('habits')) || [];
                    if (!habits.includes(newHabit)) {
                        habits.push(newHabit);
                        localStorage.setItem('habits', JSON.stringify(habits));
                        newHabitInput.value = '';
                        renderHabitTracker();
                    }
                }
            });

            function renderHabitTracker() {
                const habits = JSON.parse(localStorage.getItem('habits')) || [];
                const habitData = JSON.parse(localStorage.getItem('habitData')) || {};
                const completedDays = JSON.parse(localStorage.getItem('completedDays')) || {};
                
                weekTitle.textContent = `Tydzień ${currentWeek}`;
                prevWeekBtn.disabled = currentWeek === 1;
                nextWeekBtn.disabled = currentWeek === totalWeeks;

                habitTrackerTableBody.innerHTML = '';
                habits.forEach(habit => {
                    const tr = document.createElement('tr');
                    tr.className = 'odd:bg-gray-50 dark:odd:bg-gray-700';
                    
                    const habitNameCell = document.createElement('td');
                    habitNameCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100';
                    const habitNameSpan = document.createElement('span');
                    habitNameSpan.textContent = habit;
                    habitNameSpan.classList.add('habit-name-span');
                    habitNameCell.appendChild(habitNameSpan);
                    tr.appendChild(habitNameCell);

                    const actionsCell = document.createElement('td');
                    actionsCell.className = 'px-6 py-4 whitespace-nowrap text-right text-sm font-medium';
                    actionsCell.innerHTML = `
                        <button class="edit-habit-btn text-blue-500 hover:text-blue-700 mx-1">Edytuj</button>
                        <button class="delete-habit-btn text-red-500 hover:text-red-700 mx-1">Usuń</button>
                    `;
                    actionsCell.querySelector('.edit-habit-btn').dataset.habit = habit;
                    actionsCell.querySelector('.delete-habit-btn').dataset.habit = habit;
                    tr.appendChild(actionsCell);

                    // Render days for the current week
                    const startDay = (currentWeek - 1) * 7 + 1;
                    const endDay = Math.min(startDay + 6, totalDays);

                    for (let i = startDay; i <= endDay; i++) {
                        const cell = document.createElement('td');
                        cell.className = 'px-2 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-300 text-center';
                        const checkmark = document.createElement('div');
                        checkmark.className = 'w-6 h-6 rounded-full border-2 border-gray-300 dark:border-gray-600 cursor-pointer mx-auto';
                        checkmark.dataset.habit = habit;
                        checkmark.dataset.day = i;

                        if (habitData[habit] && habitData[habit][i]) {
                            checkmark.classList.add('bg-green-500', 'border-green-500');
                        }

                        checkmark.addEventListener('click', (e) => {
                            e.target.classList.toggle('bg-green-500');
                            e.target.classList.toggle('border-green-500');
                            e.target.classList.toggle('border-gray-300');
                            
                            const clickedHabit = e.target.dataset.habit;
                            const clickedDay = e.target.dataset.day;
                            
                            const currentHabitData = JSON.parse(localStorage.getItem('habitData')) || {};
                            if (!currentHabitData[clickedHabit]) {
                                currentHabitData[clickedHabit] = {};
                            }

                            currentHabitData[clickedHabit][clickedDay] = e.target.classList.contains('bg-green-500');
                            localStorage.setItem('habitData', JSON.stringify(currentHabitData));
                            
                            // Check if this day is completed and update main tracker
                            checkDailyCompletion(clickedDay);
                        });
                        
                        cell.appendChild(checkmark);
                        tr.appendChild(cell);
                    }
                    habitTrackerTableBody.appendChild(tr);
                });
            }

            function checkDailyCompletion(day) {
                const habits = JSON.parse(localStorage.getItem('habits')) || [];
                const habitData = JSON.parse(localStorage.getItem('habitData')) || {};
                const completedDays = JSON.parse(localStorage.getItem('completedDays')) || {};

                // Added check for the case when there are no habits.
                if (habits.length === 0) {
                    delete completedDays[day];
                } else {
                    const allHabitsCompletedForDay = habits.every(habit => habitData[habit] && habitData[habit][day]);

                    if (allHabitsCompletedForDay) {
                        completedDays[day] = true;
                    } else {
                        delete completedDays[day];
                    }
                }

                localStorage.setItem('completedDays', JSON.stringify(completedDays));
                updateTracker();
            }

            // Navigation
            prevWeekBtn.addEventListener('click', () => {
                if (currentWeek > 1) {
                    currentWeek--;
                    renderHabitTracker();
                }
            });

            nextWeekBtn.addEventListener('click', () => {
                if (currentWeek < totalWeeks) {
                    currentWeek++;
                    renderHabitTracker();
                }
            });

            // Edit and Delete functionality
            habitTrackerTableBody.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-habit-btn')) {
                    habitToDelete = e.target.dataset.habit;
                    deleteModal.style.display = 'flex';
                }
                if (e.target.classList.contains('edit-habit-btn')) {
                    const oldHabit = e.target.dataset.habit;
                    const newHabit = prompt('Wprowadź nową nazwę nawyku:', oldHabit);
                    if (newHabit && newHabit.trim() !== '' && newHabit !== oldHabit) {
                        const habits = JSON.parse(localStorage.getItem('habits')) || [];
                        const habitData = JSON.parse(localStorage.getItem('habitData')) || {};
                        
                        const habitIndex = habits.indexOf(oldHabit);
                        if (habitIndex > -1) {
                            habits[habitIndex] = newHabit;
                            localStorage.setItem('habits', JSON.stringify(habits));
                        }
                        
                        if (habitData[oldHabit]) {
                            habitData[newHabit] = habitData[oldHabit];
                            delete habitData[oldHabit];
                            localStorage.setItem('habitData', JSON.stringify(habitData));
                        }
                        renderHabitTracker();
                    }
                }
            });

            // Modal event listeners
            confirmDeleteBtn.addEventListener('click', () => {
                const habits = JSON.parse(localStorage.getItem('habits')) || [];
                const habitData = JSON.parse(localStorage.getItem('habitData')) || {};
                
                const updatedHabits = habits.filter(h => h !== habitToDelete);
                localStorage.setItem('habits', JSON.stringify(updatedHabits));
                
                delete habitData[habitToDelete];
                localStorage.setItem('habitData', JSON.stringify(habitData));
                
                deleteModal.style.display = 'none';

                // Po usunięciu nawyku, ponownie sprawdzamy status ukończenia dla wszystkich dni
                for (let i = 1; i <= totalDays; i++) {
                    checkDailyCompletion(i);
                }

                renderHabitTracker();
            });

            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.style.display = 'none';
                habitToDelete = null;
            });


            // Initial setup
            startDateInput.addEventListener('change', (e) => {
                localStorage.setItem('startDate', e.target.value);
                updateDates(e.target.value);
                updateTracker();
            });
        });
    </script>
</body>
</html>
